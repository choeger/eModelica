<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
     28.04.2009 14:03:28                                                        

     parser generation    
     generates a new eModelica parser if necessary
                   
     choeger                                                                
     ====================================================================== -->
<project name="parser generation" default="default">
	<description>
            generates a new eModelica parser if necessary
    </description>
	
	<property name="grammar" value="modelica"/>

	<!-- ================================= 
          target: default              
         ================================= -->
	<target name="default" depends="generate, nogenerate"/>
	
	<target name="nogenerate" depends="uptodatecheck" if="uptodate">
		<echo>parser is uptodate - no generation required</echo>
	</target>
	
	<target name="generate" depends="uptodatecheck" unless="uptodate" description="generates a new eModelica parser if necessary">
		<echo>regenerating parser. This may take a while...</echo>
		<echo>${compile_classpath}</echo>
		<java classpath="${compile_classpath}" 
			classname="de.tuberlin.uebb.page.generator.ParserGenerator">
			<arg value="-v"/>
			<arg value="-d"/>
			<arg value="${source_dir}/de/tuberlin/uebb/emodelica/generated/parser"/>
			<arg value="-r"/>
			<arg value="${resources_dir}"/>
			<arg value="-p"/>
			<arg value="de.tuberlin.uebb.emodelica.generated.parser"/>
			<arg value="-i"/>
			<arg value="${resources_dir}/${grammar}.gram"/>
			<arg value="-l"/>
			<arg value="${resources_dir}/${grammar}.lex"/>
			<arg value="-g"/>
			<arg value="${grammar}"/>
		</java>
		
		<!-- we do not need that file maybe we'll add an option for that to generator later -->
		<delete file="${source_dir}/de/tuberlin/uebb/modelica/im/generated/parser/Parser.java"/>
	</target>
	
	<target name="uptodatecheck">
		
		<uptodate property="uptodate1" targetfile="${resources_dir}/${grammar}.data">
			<srcfiles dir="${resources_dir}">
				<filename name="modelica.gram"/>
			</srcfiles>
		</uptodate>
		
		<uptodate property="uptodate2" targetfile="${resources_dir}/${grammar}.data">
			<srcfiles dir="${resources_dir}">
				<filename name="modelica.lex"/>
			</srcfiles>
		</uptodate>
		
		<condition property="uptodate">
			<and>
				<isset property="uptodate1"/>
				<isset property="uptodate2"/>
			</and>
		</condition>
	</target>
</project>
